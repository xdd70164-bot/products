<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>1 月活動獎勵｜等待兌換</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:#f6f6f6;
  text-align:center;
  padding:40px 16px;
}
.card{
  max-width:420px;
  margin:0 auto;
  background:#fff;
  padding:24px 20px 28px;
  border-radius:16px;
  box-shadow:0 8px 24px rgba(0,0,0,.06);
}
.small{color:#666;font-size:14px;margin-top:10px;}
.done{color:#27ae60;font-weight:600;}
</style>
</head>
<body>

<div class="card" id="box"></div>

<script>
const me = JSON.parse(sessionStorage.getItem('me'));
const box = document.getElementById('box');

if(!me){
  location.href = "index.html";
}

function pickedKey(){
  return "picked_" + me.no;
}
function isPicked(){
  return localStorage.getItem(pickedKey()) === "true";
}

function check(){
  const current = parseInt(localStorage.getItem('currentTurn') || "1", 10);

  // 已完成
  if(isPicked()){
    box.innerHTML = `
      <div class="done">✅ 你已完成兌換</div>
      <p><b>${me.name}</b></p>
      <div class="small">如有問題請洽工作人員</div>
    `;
    return;
  }

  // 輪到你
  if(current === me.rank){
    location.href = "products.html";
    return;
  }

  // 尚未輪到
  box.innerHTML = `
    <h3>${me.name}</h3>
    你的順位：第 <b>${me.rank}</b> 名（${me.score} 分）<br>
    目前輪到：第 <b>${current}</b> 名
    <div class="small">尚未輪到你，請稍候</div>
  `;

  setTimeout(check, 1500);
}

check();
</script>

</body>
</html>
