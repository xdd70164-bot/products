<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>1 æœˆæ´»å‹•çå‹µï½œæ´»å‹•å…Œæ›å°ˆå€</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;background:#f6f6f6;color:#222;}
header{text-align:center;padding:40px 20px 24px;}
header h1{margin:0;font-size:28px;letter-spacing:2px;}
header p{margin-top:12px;color:#666;font-size:14px;line-height:1.6;}

.grid{max-width:1200px;margin:30px auto 60px;padding:0 16px;
display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:22px;}

.card{background:#fff;border-radius:14px;overflow:hidden;
box-shadow:0 8px 24px rgba(0,0,0,.06);position:relative;cursor:pointer;}

.card img{width:100%;height:180px;object-fit:contain;background:#fafafa;cursor:zoom-in;}
@media(max-width:480px){.card img{height:140px;}}

.info{padding:14px;text-align:center;}
.name{font-weight:600;font-size:15px;margin-bottom:6px;}
.stock{font-size:13px;color:#555;}
.low{color:#b8860b;background:#fff6dc;padding:2px 6px;border-radius:6px;display:inline-block;}
.sold{color:#aaa;text-decoration:line-through;}

.badge{position:absolute;top:10px;left:10px;font-size:12px;padding:4px 12px;border-radius:20px;}
.badge.done{background:#95a5a6;color:#fff;}
.badge.soon{background:#f39c12;color:#fff;}
.badge.gold{
  background:linear-gradient(135deg,#cfa63a,#f5e28c,#cfa63a);
  color:#3a2a00;font-weight:600;border:1px solid rgba(255,255,255,.6);
  box-shadow:0 4px 10px rgba(0,0,0,.25);
}

footer{text-align:center;font-size:12px;color:#999;padding-bottom:30px;}

.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);
justify-content:center;align-items:center;z-index:999;}
.overlay img{max-width:90%;max-height:90%;border-radius:10px;}
</style>
</head>

<body>

<header>
  <h1>1 æœˆæ´»å‹•çå‹µï½œå…Œæ›å°ˆå€</h1>
  <p>
    æ´»å‹•æœŸé–“ï¼š2026 / 1 / 1 â€“ 2026 / 1 / 31<br>
    æ•¸é‡æœ‰é™ï¼Œå…Œå®Œç‚ºæ­¢
  </p>
</header>

<div class="grid">

<div class="card" data-stock="1" onclick="selectItem(this)"><img src="images/electrolux-kettle.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">ä¼ŠèŠå…‹æ–¯æº«æ§é›»èŒ¶å£º</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š1</div></div></div>

<div class="card" data-stock="1" onclick="selectItem(this)"><img src="images/samsonite-mini-case.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">æ–°ç§€éº—è¿·ä½ æ‰‹æè¡Œæç®±</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š1</div></div></div>

<div class="card" data-stock="1" onclick="selectItem(this)"><img src="images/worldwide-cabin-case.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">è¬åœ‹æ—…è¡Œç™»æ©Ÿç®±</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š1</div></div></div>

<div class="card" data-stock="2" onclick="selectItem(this)"><img src="images/koson-massage-shawl.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">åº·ç”ŸæŒ‰æ‘©æŠ«è‚©</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š2</div></div></div>

<div class="card" data-stock="2" onclick="selectItem(this)"><img src="images/nonstick-pan.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">ä¸æ²¾é‹</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š2</div></div></div>

<div class="card" data-stock="1" onclick="selectItem(this)"><img src="images/frying-pan-30cm.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">30 å…¬åˆ†ç‚’é‹</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š1</div></div></div>

<div class="card" data-stock="1" onclick="selectItem(this)"><img src="images/tanita-body-scale.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">TANITA é«”è„‚ç£…ç§¤</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š1</div></div></div>

<div class="card" data-stock="2" onclick="selectItem(this)"><img src="images/wood-bluetooth-speaker.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">æ¾æœ¨è—ç‰™å–‡å­</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š2</div></div></div>

<div class="card" data-stock="1" onclick="selectItem(this)"><img src="images/egg-cooker.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">è²å¯¶ç…®è›‹ç¥å™¨</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š1</div></div></div>

<div class="card" data-stock="2" onclick="selectItem(this)"><img src="images/amway-folding-cart.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">å®‰éº—æŠ˜ç–Šè³¼ç‰©è»Š</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š2</div></div></div>

<div class="card" data-stock="155" onclick="selectItem(this)"><img src="images/nutrilite-thermos-90.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">ç´å´”èŠ 90 é€±å¹´ä¿æº«å£º</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š155</div></div></div>

<div class="card" data-stock="67" onclick="selectItem(this)"><img src="images/nutrilite-shopping-bag-90.png" onclick="zoom(event,this)">
<div class="info"><div class="name">ç´å´”èŠ 90 é€±å¹´è³¼ç‰©æè¢‹</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š67</div></div></div>

<div class="card" data-stock="28" onclick="selectItem(this)"><img src="images/shaker-banana-yellow.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">90 é€±å¹´é¦™è•‰é»ƒæ–æ–æ¯</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š28</div></div></div>

<div class="card" data-stock="16" onclick="selectItem(this)"><img src="images/nutrilite-electric-shaker.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">ç´å´”èŠ 90 é€±å¹´é›»å‹•æ”ªæ‹Œæ¯</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š16</div></div></div>

<div class="card" data-stock="5" onclick="selectItem(this)"><img src="images/nutrilite-towel-90.png" onclick="zoom(event,this)">
<div class="info"><div class="name">ç´å´”èŠ 90 é€±å¹´é‹å‹•æ¯›å·¾</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š5</div></div></div>

<div class="card" data-stock="2" onclick="selectItem(this)"><img src="images/nutrilite-towel-dual.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">ç´å´”èŠé›™è‰²é‹å‹•æ¯›å·¾</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š2</div></div></div>

<div class="card" data-stock="24" onclick="selectItem(this)"><img src="images/nutrilite-neck-pillow.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">ç´å´”èŠ 90 é€±å¹´é ¸æ•</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š24</div></div></div>

<div class="card" data-stock="5" onclick="selectItem(this)"><img src="images/nutrilite-folding-chair.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">ç´å´”èŠ 90 é€±å¹´æ‰¶æ‰‹æŠ˜ç–Šæ¤…</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š5</div></div></div>

<div class="card" data-stock="13" onclick="selectItem(this)"><img src="images/xs-classic-cap.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">XS ç¶“å…¸é´¨èˆŒå¸½</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š13</div></div></div>

<div class="card" data-stock="4" onclick="selectItem(this)"><img src="images/xs-waterproof-bag-pink.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">XS æˆ²æ°´è¢‹ï¼ˆç²‰ï¼‰</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š4</div></div></div>

<div class="card" data-stock="4" onclick="selectItem(this)"><img src="images/xs-waterproof-bag-yellow.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">XS æˆ²æ°´è¢‹ï¼ˆé»ƒï¼‰</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š4</div></div></div>

<div class="card" data-stock="6" onclick="selectItem(this)"><img src="images/eco-tableware.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">ç’°ä¿é¤å…·</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š6</div></div></div>

<div class="card" data-stock="1" onclick="selectItem(this)"><img src="images/adventure-cutlery-set.jpg" onclick="zoom(event,this)">
<div class="info"><div class="name">æ¢éšªéš¨èº«é¤å…·åä»¶çµ„</div><div class="stock">å‰©é¤˜æ•¸é‡ï¼š1</div></div></div>

</div>

<footer>Â© åœ–ç‰‡åƒ…ä¾›ç¤ºæ„ï¼Œå¯¦éš›å…Œæ›å“é …ä»¥ç¾å ´å…¬å‘Šç‚ºæº–</footer>

<div class="overlay" onclick="this.style.display='none'">
  <img id="zoomImg">
</div>

<script>
/** ============================
 *  0) èº«åˆ†èˆ‡è§£é–æª¢æŸ¥ï¼ˆæ ¸å¿ƒï¼‰
 * ============================ */
const me = JSON.parse(sessionStorage.getItem('me'));
if(!me){ location.href="index.html"; }

function pickedKey(){ return "picked_" + me.no; }
function isPicked(){ return localStorage.getItem(pickedKey()) === "true"; }

const currentTurn = parseInt(localStorage.getItem('currentTurn') || "1", 10);

// å·²å…Œæ› or é‚„æ²’è¼ªåˆ°ä½  â†’ å›ç­‰å¾…é 
if(isPicked() || currentTurn !== me.rank){
  location.href="wait.html";
}

/** ============================
 *  1) åº«å­˜æŒä¹…åŒ–ï¼ˆé¿å…é‡æ•´æ­¸é›¶ï¼‰
 *  - æ¯å€‹å“é …ç”¨ src ç•¶ key
 * ============================ */
const grid = document.querySelector('.grid');
const cards = [...document.querySelectorAll('.card')];

function itemIdFromCard(card){
  const src = card.querySelector('img')?.getAttribute('src') || '';
  return "item_" + src.replaceAll("/","_").replaceAll(".","_");
}
function stockKey(itemId){ return "stock_" + itemId; }

function loadStock(card){
  const itemId = itemIdFromCard(card);
  card.dataset.itemId = itemId;

  const saved = localStorage.getItem(stockKey(itemId));
  if(saved !== null){
    card.dataset.stock = String(parseInt(saved,10));
  }else{
    localStorage.setItem(stockKey(itemId), String(parseInt(card.dataset.stock,10)));
  }
}
function saveStock(card){
  const itemId = card.dataset.itemId || itemIdFromCard(card);
  localStorage.setItem(stockKey(itemId), String(parseInt(card.dataset.stock,10)));
}

/** ============================
 *  2) Badge / é¡¯ç¤ºæ›´æ–°
 * ============================ */
function clearBadges(card){
  card.querySelectorAll('.badge').forEach(b=>b.remove());
}
function updateCardUI(card){
  const s = parseInt(card.dataset.stock, 10);
  const info = card.querySelector('.stock');
  clearBadges(card);

  info.classList.remove('sold','low');

  if(s <= 0){
    info.innerText = 'å·²é€å®Œ';
    info.classList.add('sold');
    card.insertAdjacentHTML('afterbegin','<div class="badge done">å·²é€å®Œ</div>');
    return;
  }

  if(s === 1){
    info.innerText = 'é™é‡ 1 ä»¶';
    info.classList.add('low');
    card.insertAdjacentHTML('afterbegin','<div class="badge gold">é™é‡</div>');
    return;
  }

  info.innerText = `å‰©é¤˜æ•¸é‡ï¼š${s}`;

  if(s <= 3){
    info.classList.add('low');
    card.insertAdjacentHTML('afterbegin','<div class="badge soon">å³å°‡é€å®Œ</div>');
  }
}

/** ============================
 *  3) æ’åºï¼šå·²é€å®Œæ”¾æœ€å¾Œï¼Œå…¶ä»–ä¾åº«å­˜å°‘â†’å¤š
 * ============================ */
function sortCards(){
  cards.sort((a,b)=>{
    const sa=parseInt(a.dataset.stock,10), sb=parseInt(b.dataset.stock,10);
    if(sa===0) return 1;
    if(sb===0) return -1;
    return sa - sb;
  }).forEach(c=>grid.appendChild(c));
}

/** ============================
 *  4) è¨˜éŒ„å…Œæ›ï¼ˆåŒ¯å‡ºç”¨ï¼‰
 * ============================ */
function savePickLog(itemName){
  const logs = JSON.parse(localStorage.getItem('pickLog') || "[]");
  const now = new Date();
  const time = now.getFullYear() + "-" +
    String(now.getMonth()+1).padStart(2,"0") + "-" +
    String(now.getDate()).padStart(2,"0") + " " +
    String(now.getHours()).padStart(2,"0") + ":" +
    String(now.getMinutes()).padStart(2,"0");

  logs.push({
    rank: me.rank,
    no: me.no,
    name: me.name,
    score: me.score,
    item: itemName,
    time
  });

  localStorage.setItem("pickLog", JSON.stringify(logs));
}

/** ============================
 *  5) é¸çï¼ˆè¼ªåˆ°æ‰å¯é¸ / ä¸€äººä¸€é¸ / é¸å®Œå›ç­‰å¾…ï¼‰
 * ============================ */
function selectItem(card){
  // é˜²å‘†ï¼šå·²å…Œæ› or éæœ¬äººå›åˆ
  const current = parseInt(localStorage.getItem('currentTurn') || "1", 10);
  if(isPicked() || current !== me.rank){
    location.href="wait.html";
    return;
  }

  let stock = parseInt(card.dataset.stock, 10);
  if(stock <= 0){
    alert("æ­¤å“é …å·²å…Œæ›å®Œ");
    return;
  }

  const itemName = card.querySelector('.name')?.innerText?.trim() || "æœªå‘½åå“é …";
  if(!confirm(`è¼ªåˆ°ä½ äº†ï¼š${me.name}\nç¢ºå®šå…Œæ›ã€Œ${itemName}ã€ï¼Ÿ`)) return;

  // æ‰£åº«å­˜ + ä¿å­˜
  stock -= 1;
  card.dataset.stock = String(stock);
  saveStock(card);

  // UI æ›´æ–°
  updateCardUI(card);
  sortCards();

  // ç´€éŒ„ + é–å®šæ­¤äºº
  savePickLog(itemName);
  localStorage.setItem(pickedKey(), "true");

  // å›ç­‰å¾…é ï¼ˆä½ é¸çš„ Bï¼‰
  setTimeout(()=>location.href="wait.html", 600);
}

/** ============================
 *  6) åœ–ç‰‡æ”¾å¤§ï¼ˆä¿ç•™åŸåŠŸèƒ½ï¼‰
 *  - é‡è¦ï¼šé˜»æ­¢å†’æ³¡ï¼Œä¸è¦èª¤è§¸é¸ç
 * ============================ */
function zoom(ev, img){
  ev.stopPropagation();
  document.getElementById('zoomImg').src = img.src;
  document.querySelector('.overlay').style.display = 'flex';
}

/** ============================
 *  7) åˆå§‹åŒ–
 * ============================ */
cards.forEach(c=>{
  loadStock(c);
  updateCardUI(c);
});
sortCards();
</script>

</body>
</html>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBEmxW-TqnxW3pgoXc2pfatFtqSQQkqMsE",
  authDomain: "january-reward.firebaseapp.com",
  databaseURL: "https://january-reward-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "january-reward",
  storageBucket: "january-reward.appspot.com",
  messagingSenderId: "881794098293",
  appId: "1:881794098293:web:453715a4382bd6651d843c"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const me = JSON.parse(sessionStorage.getItem('me'));
if(!me){ location.href="index.html"; }

function pickedKey(){ return "picked_" + me.no; }
function isPicked(){ return localStorage.getItem(pickedKey()) === "true"; }

// ğŸ”’ ä¸æ˜¯ä½ çš„é †ä½å°±é€²ä¸ä¾†
db.ref("currentTurn").once("value").then(snap=>{
  const current = snap.val() || 1;
  if(isPicked() || current !== me.rank){
    location.href="wait.html";
  }
});
</script>



