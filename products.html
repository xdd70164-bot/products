<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>1 æœˆæ´»å‹•çå‹µï½œé¸æ“‡çå“</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:#f6f6f6;
  padding:30px;
}
h2{text-align:center;}
.grid{
  max-width:900px;
  margin:20px auto;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px;
}
.card{
  background:#fff;
  border-radius:14px;
  padding:16px;
  box-shadow:0 8px 24px rgba(0,0,0,.06);
  text-align:center;
}
button{
  margin-top:10px;
  padding:10px 16px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}
</style>
</head>
<body>

<h2>è«‹é¸æ“‡ä½ çš„çå“</h2>

<div class="grid">
  <div class="card">
    <h3>çå“ A</h3>
    <button onclick="pick('çå“ A')">é¸æ“‡</button>
  </div>
  <div class="card">
    <h3>çå“ B</h3>
    <button onclick="pick('çå“ B')">é¸æ“‡</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
/* Firebase è¨­å®š */
const firebaseConfig = {
  apiKey: "AIzaSyBEmxW-TqnxW3pgoXc2pfatFtqSQQkqMsE",
  authDomain: "january-reward.firebaseapp.com",
  databaseURL: "https://january-reward-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "january-reward",
  storageBucket: "january-reward.appspot.com",
  messagingSenderId: "881794098293",
  appId: "1:881794098293:web:453715a4382bd6651d843c"
};

/* åˆå§‹åŒ– Firebase */
if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
}
const db = firebase.database();

/* ä½¿ç”¨è€…è³‡æ–™ */
const me = JSON.parse(sessionStorage.getItem("me"));
if(!me){
  location.href = "index.html";
}

function pickedKey(){ return "picked_" + me.no; }
function isPicked(){ return localStorage.getItem(pickedKey()) === "true"; }

/* ğŸ” é€šè¡Œè­‰æª¢æŸ¥ï¼ˆé˜²è¢«è¸¢å›ï¼‰ */
const pass = sessionStorage.getItem("canPick");
if(pass !== "yes"){
  location.href = "wait.html";
}
sessionStorage.removeItem("canPick");

/* å†æ¬¡ç¢ºèªé †ä½ */
db.ref("currentTurn").once("value").then(snap=>{
  const current = Number(snap.val());
  if(isPicked() || current !== Number(me.rank)){
    location.href = "wait.html";
  }
});

/* é¸æ“‡çå“ */
function pick(item){
  localStorage.setItem(pickedKey(),"true");

  db.ref("pickLog").push({
    no: me.no,
    name: me.name,
    rank: me.rank,
    item: item,
    time: new Date().toISOString()
  });

  alert("ä½ å·²é¸æ“‡ï¼š" + item);
  location.href = "wait.html";
}
</script>

</body>
</html>



